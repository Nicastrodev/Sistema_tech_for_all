<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detalhes da Turma - Tech For All</title>
    <link rel="stylesheet" href="/styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <!-- HEADER -->
    <header class="header">
      <div class="header-container">
        <div class="brand">
          <div class="logo">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
              <path
                d="M16 2L28 9V23L16 30L4 23V9L16 2Z"
                fill="white"
                opacity="0.2"
              />
              <path
                d="M16 8L22 11.5V18.5L16 22L10 18.5V11.5L16 8Z"
                fill="white"
              />
            </svg>
          </div>
          <div class="brand-text">
            <h1>Tech For All</h1>
            <p>Inclus√£o Digital com Seguran√ßa</p>
          </div>
        </div>
        <div class="header-actions">
          <div class="role-badge" id="currentRole">Professor</div>
          <button class="btn-secondary" onclick="logout()">Sair</button>
        </div>
      </div>
    </header>

    <!-- MAIN -->
    <main class="main-container">
      <section class="screen">
        <!-- Breadcrumb -->
        <div class="breadcrumb">
          <a href="#" id="dashboardLink" class="breadcrumb-link">Dashboard</a>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-current" id="breadcrumbClassName">
            Carregando...
          </span>
        </div>

        <!-- Cabe√ßalho da turma -->
        <div class="dashboard-header">
          <div>
            <h2 id="className">Carregando...</h2>
            <p class="subtitle" id="pageSubtitle">
              Gerencie sua turma e acompanhe o progresso dos alunos
            </p>
          </div>
          <div class="header-buttons" id="teacherActions">
            <button class="btn-outline" onclick="editClass()">
              Editar Turma
            </button>
          </div>
        </div>

        <!-- Estat√≠sticas -->
        <div class="stats-grid" id="teacherStats">
          <div class="stat-card">
            <div class="stat-icon blue">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              </svg>
            </div>
            <div class="stat-content">
              <p class="stat-label">Total de Alunos</p>
              <h3 class="stat-value" id="totalStudents">0</h3>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon green">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
              </svg>
            </div>
            <div class="stat-content">
              <p class="stat-label">M√©dia Geral</p>
              <h3 class="stat-value" id="averageGrade">0.0</h3>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon purple">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="9 11 12 14 22 4"></polyline>
                <path
                  d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"
                ></path>
              </svg>
            </div>
            <div class="stat-content">
              <p class="stat-label">Frequ√™ncia M√©dia</p>
              <h3 class="stat-value" id="averageAttendance">0%</h3>
            </div>
          </div>
        </div>

        <div class="content-grid">
          <!-- Conte√∫do principal -->
          <div class="main-content">
            <!-- Informa√ß√µes da turma -->
            <div class="card" style="margin-bottom: 24px">
              <div class="card-header">
                <h3>Informa√ß√µes da Turma</h3>
              </div>
              <div class="class-info-grid">
                <div class="info-item">
                  <label class="info-label">Nome da Turma</label>
                  <p class="info-value" id="classNameDetail">Carregando...</p>
                </div>
                <div class="info-item">
                  <label class="info-label">C√≥digo de Acesso</label>
                  <div class="code-display">
                    <span class="info-value code-value" id="classCode"
                      >------</span
                    >
                    <button
                      class="btn-copy"
                      onclick="copyCode()"
                      title="Copiar c√≥digo"
                    >
                      üìã
                    </button>
                  </div>
                </div>
                <div class="info-item full-width">
                  <label class="info-label">Descri√ß√£o</label>
                  <p class="info-value" id="classDescription">Carregando...</p>
                </div>
              </div>
            </div>

            <!-- Lista de alunos -->
            <div class="card">
              <div class="card-header">
                <h3>Alunos Inscritos</h3>
                <p>Lista completa de alunos matriculados na turma</p>
              </div>

              <div class="search-box">
                üîç
                <input
                  type="text"
                  id="searchStudent"
                  placeholder="Buscar aluno por nome..."
                  onkeyup="filterStudents()"
                />
              </div>

              <div class="students-table-container">
                <table class="students-table">
                  <thead>
                    <tr>
                      <th>Nome</th>
                      <th>Email</th>
                      <th>Frequ√™ncia</th>
                      <th>M√©dia</th>
                      <th id="actionsHeader">A√ß√µes</th>
                    </tr>
                  </thead>
                  <tbody id="studentsTableBody">
                    <tr>
                      <td colspan="5" style="text-align: center; padding: 40px">
                        <p style="color: var(--text-secondary)">
                          Carregando alunos...
                        </p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Sidebar -->
          <aside class="sidebar">
            <div class="card" id="quickActions">
              <h3>A√ß√µes R√°pidas</h3>
              <nav class="sidebar-nav">
                <a href="/diary" class="nav-item">üìù Registrar Aula</a>
                <a href="/activities/teacher" class="nav-item"
                  >üìã Atividades
                </a>
                <a
                  href="#"
                  onclick="generateReport();return false;"
                  class="nav-item"
                  >üìä Gerar Relat√≥rio PDF</a
                >
              </nav>
            </div>

            <div class="card" style="margin-top: 16px" id="teacherStatsCard">
              <h3>Estat√≠sticas</h3>
              <div class="stats-list">
                <div class="stat-item">
                  <span class="stat-item-label">Aprovados</span>
                  <span class="stat-item-value success" id="approvedCount"
                    >0</span
                  >
                </div>
                <div class="stat-item">
                  <span class="stat-item-label">Em Recupera√ß√£o</span>
                  <span class="stat-item-value warning" id="recoveryCount"
                    >0</span
                  >
                </div>
                <div class="stat-item">
                  <span class="stat-item-label">Reprovados</span>
                  <span class="stat-item-value danger" id="failedCount">0</span>
                </div>
              </div>
            </div>
          </aside>
        </div>
      </section>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
      <p>
        &copy; 2025 Tech For All - Inclus√£o Digital com Seguran√ßa | Prot√≥tipo
        Acad√™mico
      </p>
    </footer>

    <script src="/common.js"></script>
    <script src="/turma.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const s = getSession();
        const link = document.getElementById("dashboardLink");
        const roleBadge = document.getElementById("currentRole");

        // Define destino do dashboard e t√≠tulo do papel
        if (s?.role === "teacher") {
          link.href = "/dashboard/teacher";
          roleBadge.textContent = "Professor";
        } else if (s?.role === "student") {
          link.href = "/dashboard/student";
          roleBadge.textContent = "Aluno";
        } else {
          link.href = "/";
          roleBadge.textContent = "Visitante";
        }

        // üîí Controle de acesso din√¢mico
        if (s?.role === "student") {
          // Esconde se√ß√µes exclusivas de professor
          document.getElementById("teacherActions")?.remove();
          document.getElementById("teacherStats")?.remove();
          document.getElementById("quickActions")?.remove();
          document.getElementById("teacherStatsCard")?.remove();
          document.getElementById("actionsHeader")?.remove();
          document.getElementById("pageSubtitle").textContent =
            "Visualize as informa√ß√µes da turma e seu desempenho";
        } else if (s?.role === "teacher") {
          // Garante que todos os blocos do professor estejam vis√≠veis (caso cache ou reload)
          document.getElementById("teacherActions")?.classList.remove("hidden");
          document.getElementById("teacherStats")?.classList.remove("hidden");
          document.getElementById("quickActions")?.classList.remove("hidden");
          document
            .getElementById("teacherStatsCard")
            ?.classList.remove("hidden");
          document.getElementById("pageSubtitle").textContent =
            "Gerencie sua turma e acompanhe o progresso dos alunos";
        }

        // Garante carregamento da turma
        if (typeof loadTurma === "function") loadTurma();
      });
    </script>
  </body>
</html>
